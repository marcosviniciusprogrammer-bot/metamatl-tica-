<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MetamatlÃ©tica â€” Jogo da MemÃ³ria v3.18</title>
  <style>
    :root{
      --bg:#060917;--bg2:#0a1030;--panel:#0c1331;--card:#0e163c;
      --muted:#a7b0c7;--text:#f2f6ff;--accent:#7aa2ff;
      --radius:24px;--shadow:0 18px 50px rgba(0,0,0,.55)
    }
    *{box-sizing:border-box}
    body{
      margin:0;min-height:100dvh;display:flex;align-items:center;justify-content:center;
      font-family:Inter,ui-sans-serif,system-ui;background:
        radial-gradient(900px 700px at 110% -10%, #0f1f6a66, transparent),
        radial-gradient(1000px 700px at 5% -10%, #20307a55, transparent),
        linear-gradient(180deg,var(--bg),var(--bg2));
      color:var(--text);padding:22px
    }
    .app{width:min(1150px,100%)}
    .glass{background:linear-gradient(180deg,rgba(255,255,255,.10),rgba(255,255,255,.04));
      border:1px solid rgba(255,255,255,.15);backdrop-filter:blur(12px);border-radius:var(--radius);box-shadow:var(--shadow)}
    .wrap{padding:20px;animation:fadeIn .7s ease}
    @keyframes fadeIn{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}
    .btn{background:rgba(20,28,80,.85);border:1px solid #2a3a7a;color:var(--text);
      padding:14px 16px;border-radius:16px;font-weight:800;cursor:pointer;
      transition:.2s transform ease,.2s box-shadow ease}
    .btn:hover{transform:translateY(-2px);box-shadow:0 12px 28px rgba(90,130,255,.35)}
    .btn:active{transform:scale(.96)}
    .btn.primary{background:linear-gradient(180deg,#9ec2ff,#5b86ff);color:#0a0f1e;border:none}
    .row{display:flex;gap:14px;flex-wrap:wrap;align-items:center}
    .screen{display:none}.screen.active{display:block}
    .board{display:grid;gap:14px;padding:16px;border-radius:var(--radius);background:rgba(255,255,255,.03);
      border:1px solid rgba(255,255,255,.12)}
    .cols-5{grid-template-columns:repeat(5,1fr)}.cols-6{grid-template-columns:repeat(6,1fr)}
    .tile{position:relative;aspect-ratio:3/4;border:none;border-radius:20px;overflow:hidden;cursor:pointer;perspective:1000px;outline:none}
    .tile-inner{position:absolute;inset:0;transform-style:preserve-3d;transition:transform .5s cubic-bezier(.2,.8,.2,1)}
    .tile.flip .tile-inner{transform:rotateY(180deg)}
    .face{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;backface-visibility:hidden;border-radius:20px}
    .face.front{background:radial-gradient(120% 120% at 20% 0%, #1d2a63, #101944 70%);border:1px solid #2f3e89}
    .face.back{transform:rotateY(180deg);border:1px solid rgba(255,255,255,.25);
      background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04))}
    .emoji{font-size:clamp(30px, 6.5vw, 54px)}
    .gbar{display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:space-between;margin-bottom:12px}
    .stat{background:rgba(12,20,56,.65);border:1px solid #243056;padding:10px 12px;border-radius:12px;font-size:14px}
    .hint{margin:8px 0 12px;color:#d6deff;font-weight:800;letter-spacing:.2px;text-shadow:0 0 6px rgba(122,162,255,.5)}
    /* slider estilizado */
    .volume-wrap{display:flex;align-items:center;gap:8px;margin-top:10px}
    .slider{appearance:none;width:140px;height:8px;background:#2a3a7a;border-radius:999px;outline:none;transition:all .2s}
    .slider:hover{background:#4a6aff}
    .slider::-webkit-slider-thumb{appearance:none;width:18px;height:18px;background:#7aa2ff;border-radius:50%;cursor:pointer;box-shadow:0 0 6px #7aa2ff;transition:transform .2s}
    .slider::-webkit-slider-thumb:hover{transform:scale(1.15)}
  </style>
</head>
<body>
  <div class="app">
    <!-- LOBBY -->
    <section id="screen-lobby" class="screen active">
      <div class="wrap glass">
        <h1>ğŸ® MetamatlÃ©tica â€” Jogo da MemÃ³ria</h1>
        <p class="muted">Escolha o tamanho e o tema e clique em <b>Jogar</b>.</p>

        <div class="row">
          <div>
            <label>Tamanho</label>
            <select id="deckSize">
              <option value="20">20 cartas (5Ã—4)</option>
              <option value="30">30 cartas (6Ã—5)</option>
            </select>
          </div>
          <div>
            <label>Tema</label>
            <select id="theme">
              <option value="cores">Cores</option>
              <option value="frutas">Frutas</option>
            </select>
          </div>
        </div>

        <label class="row" style="margin-top:8px">
          <input type="checkbox" id="cbPreview" checked>
          Mostrar prÃ©via de <b>5s</b> antes de comeÃ§ar
        </label>

        <div class="row" style="margin-top:12px">
          <button id="btnPlay" class="btn primary">ğŸš€ Jogar</button>
          <button id="btnToggleSound" class="btn">ğŸ”ˆ Som: ON</button>
          <div class="volume-wrap">
            <span>ğŸ”Š</span><input type="range" id="volumeSlider" class="slider" min="0" max="100" value="70">
          </div>
        </div>
      </div>
    </section>

    <!-- GAME -->
    <section id="screen-game" class="screen">
      <div class="wrap glass">
        <div class="gbar">
          <div class="row">
            <button class="btn" id="btnBackInGame">â† Lobby</button>
            <button class="btn" id="btnRestart">Reiniciar</button>
            <button class="btn" id="btnToggleSoundGame">ğŸ”ˆ Som: ON</button>
            <div class="volume-wrap">
              <span>ğŸ”Š</span><input type="range" id="volumeSliderGame" class="slider" min="0" max="100" value="70">
            </div>
          </div>
          <div class="row">
            <div class="stat">â±ï¸ <b id="time">00:00</b></div>
            <div class="stat">ğŸƒ <b id="moves">0</b> jogadas</div>
            <div class="stat">âœ… <b id="pairs">0</b> pares</div>
          </div>
        </div>
        <div id="hint" class="hint" aria-live="polite">Boa sorte! ğŸ‘€</div>
        <div id="board" class="board"></div>
      </div>
    </section>

    <!-- WIN -->
    <section id="screen-win" class="screen">
      <div class="wrap glass" style="text-align:center">
        <h2>ğŸ‘‘ VocÃª venceu!</h2>
        <div class="row" style="justify-content:center;margin:10px 0 14px">
          <div class="stat">â±ï¸ <b id="wTime">00:00</b></div>
          <div class="stat">ğŸ¯ <b id="wMoves">0</b> jogadas</div>
          <div class="stat">âœ… <b id="wPairs">0</b> pares</div>
        </div>
        <div class="row" style="justify-content:center">
          <button class="btn primary" id="btnPlayAgain">Jogar de novo</button>
          <button class="btn" id="btnBackFromWin">â† Lobby</button>
        </div>
      </div>
    </section>
  </div>

  <script>
  // ------------- helpers
  const $=s=>document.querySelector(s);
  const fmtTime=s=>`${String(Math.floor(s/60)).padStart(2,'0')}:${String(s%60).padStart(2,'0')}`;
  const shuffle=a=>{for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a};

  // ------------- Ã¡udio
  const CLICK_URL="audio/Click.mp3";
  const GAME_MUSIC_URL="audio/Playground-Of-The-Stars-A.mp3";

  const AudioFX={
    inited:false, masterVol:0.7, music:null,
    init(){ if(this.inited) return; this.inited=true; },
    playClick(){ if(!this.inited) return; const a=new Audio(CLICK_URL); a.volume=this.masterVol; a.play().catch(()=>{}); },
    playMusic(){ if(!this.inited) return; this.stopMusic(); const a=new Audio(GAME_MUSIC_URL); a.loop=true; a.volume=this.masterVol; a.play().catch(()=>{}); this.music=a; },
    stopMusic(){ if(this.music){ this.music.pause(); this.music=null; } },
    setVolume(v){ this.masterVol=v; if(this.music) this.music.volume=v; }
  };

  // ------------- som ON/OFF + volume (persistÃªncia)
  const SND_KEY='mm_sound_on', VOL_KEY='mm_vol';
  let SOUND_ON = localStorage.getItem(SND_KEY)===null ? true : localStorage.getItem(SND_KEY)==='true';
  let VOLUME = localStorage.getItem(VOL_KEY) ? +localStorage.getItem(VOL_KEY) : 0.7;

  function syncVolumeUI(){
    const val = Math.round(VOLUME*100);
    if($('#volumeSlider')) $('#volumeSlider').value = val;
    if($('#volumeSliderGame')) $('#volumeSliderGame').value = val;
  }
  function setSound(on){
    SOUND_ON = on; localStorage.setItem(SND_KEY, on?'true':'false');
    $('#btnToggleSound').textContent = on ? 'ğŸ”ˆ Som: ON' : 'ğŸ”‡ Som: OFF';
    $('#btnToggleSoundGame').textContent = on ? 'ğŸ”ˆ Som: ON' : 'ğŸ”‡ Som: OFF';
    AudioFX.setVolume(on ? VOLUME : 0);
  }
  function setVolumeFromSlider(v){
    VOLUME = Math.max(0, Math.min(1, v));
    localStorage.setItem(VOL_KEY, VOLUME.toString());
    AudioFX.setVolume(SOUND_ON ? VOLUME : 0);
    syncVolumeUI();
  }

  // ------------- deck
  const FRUTAS=['ğŸ','ğŸŒ','ğŸ‡','ğŸ“','ğŸ','ğŸ‘','ğŸ‰','ğŸ¥','ğŸ','ğŸ’','ğŸŠ','ğŸˆ','ğŸ‹','ğŸ','ğŸ¥¥','ğŸ…','ğŸ†','ğŸ¥•'];
  function makeDeck(size, theme){
    const pairs=Math.floor(size/2); let items=[];
    if(theme==='cores'){
      // 15 cores Ãºnicas para 30 cartas (ou n pares), sem repetiÃ§Ã£o
      for(let i=0;i<pairs;i++){ const h=(i*24)%360; items.push({t:'cor',v:`hsl(${h} 70% 55%)`}); }
    }else{
      items = FRUTAS.slice(0,pairs).map(f=>({t:'emoji',v:f}));
    }
    return shuffle([...items, ...items]).map((x,i)=>({id:i,key:x.v,t:x.t,matched:false}));
  }

  // ------------- estado/jogo
  let G=null, timer=null, previewT=null;
  const screens={lobby:$('#screen-lobby'), game:$('#screen-game'), win:$('#screen-win')};
  function go(to){ Object.values(screens).forEach(s=>s.classList.remove('active')); screens[to].classList.add('active'); }

  function buildBoard(){
    const b=$('#board'); b.innerHTML='';
    b.className='board ' + (G.size==20?'cols-5':'cols-6');
    G.deck.forEach((c,i)=>{
      const el=document.createElement('button'); el.className='tile'; el.dataset.i=i; el.setAttribute('aria-label','Carta');
      const inner=document.createElement('div'); inner.className='tile-inner';
      const front=document.createElement('div'); front.className='face front';
      const back=document.createElement('div'); back.className='face back';
      if(c.t==='cor'){ back.style.background=c.key; }
      else { back.textContent=c.key; back.className+=' emoji'; }
      inner.appendChild(front); inner.appendChild(back); el.appendChild(inner);
      el.addEventListener('click',()=>flip(i));
      b.appendChild(el);
    });
  }

  function startTimer(){ if(timer) clearInterval(timer); timer=setInterval(()=>{ G.sec++; $('#time').textContent=fmtTime(G.sec); },1000) }
  function stopTimer(){ if(timer){ clearInterval(timer); timer=null; } }

  function startPreview(seconds=5){
    if(!$('#cbPreview').checked){ $('#hint').textContent='Escolha uma carta ğŸ‘€'; return; }
    G.lock=true;
    Array.from($('#board').children).forEach(t=>t.classList.add('flip'));
    $('#hint').textContent='Boa sorte! ğŸ‘€';
    clearTimeout(previewT);
    previewT=setTimeout(()=>{
      Array.from($('#board').children).forEach(t=>t.classList.remove('flip'));
      G.lock=false; $('#hint').textContent='Escolha uma carta ğŸ‘€';
    }, seconds*1000);
  }

  function newGame(size, theme){
    G={size, theme, deck:makeDeck(size, theme), first:null, second:null, lock:false, moves:0, pairs:0, sec:0};
    $('#moves').textContent='0'; $('#pairs').textContent='0'; $('#time').textContent='00:00';
    buildBoard(); startTimer(); go('game'); AudioFX.playMusic(); startPreview(5);
  }

  function flip(i){
    if(G.lock || G.deck[i].matched || G.first===i) return;
    const tiles=$('#board').children;
    if(G.first==null){
      tiles[i].classList.add('flip'); G.first=i; $('#hint').textContent='Escolha outra carta ğŸ‘€'; return;
    }
    tiles[i].classList.add('flip'); G.second=i; G.lock=true; G.moves++; $('#moves').textContent=G.moves;
    const a=G.deck[G.first], b=G.deck[G.second];
    if(a.key===b.key){
      a.matched=b.matched=true; G.pairs++; $('#pairs').textContent=G.pairs; $('#hint').textContent='VocÃª acertou, continue! ğŸ‰';
      setTimeout(()=>{
        G.first=G.second=null; G.lock=false;
        if(G.pairs===G.deck.length/2) win(); else $('#hint').textContent='Escolha uma carta ğŸ‘€';
      }, 550);
    }else{
      $('#hint').textContent='VocÃª errou, tente novamente! ğŸ™„';
      setTimeout(()=>{
        tiles[G.first].classList.remove('flip'); tiles[G.second].classList.remove('flip');
        G.first=G.second=null; G.lock=false; $('#hint').textContent='Escolha uma carta ğŸ‘€';
      }, 850);
    }
  }

  function win(){
    stopTimer(); AudioFX.stopMusic(); go('win');
    $('#wTime').textContent=fmtTime(G.sec);
    $('#wMoves').textContent=G.moves;
    $('#wPairs').textContent=G.pairs;
  }

  // ------------- eventos UI
  function wireClickSfx(){
    document.querySelectorAll('button').forEach(b=>{
      b.removeEventListener('__clickSfx', b.__clickSfxFn || (()=>{})); // limpeza
      const fn=()=>AudioFX.playClick();
      b.__clickSfxFn=fn; b.addEventListener('click', fn);
    });
  }

  $('#btnPlay').onclick = ()=>{AudioFX.init(); setSound(SOUND_ON); newGame(+$('#deckSize').value,$('#theme').value);};
  $('#btnRestart').onclick = ()=>{ if(G) newGame(G.size, G.theme); };
  $('#btnBackInGame').onclick = ()=>{ stopTimer(); AudioFX.stopMusic(); go('lobby'); };
  $('#btnPlayAgain').onclick = ()=>{ newGame(G.size, G.theme); };
  $('#btnBackFromWin').onclick = ()=>{ go('lobby'); };

  $('#btnToggleSound').onclick = ()=> setSound(!SOUND_ON);
  $('#btnToggleSoundGame').onclick = ()=> setSound(!SOUND_ON);

  $('#volumeSlider').oninput = e => setVolumeFromSlider(e.target.value/100);
  $('#volumeSliderGame').oninput = e => setVolumeFromSlider(e.target.value/100);

  // ------------- inicializaÃ§Ã£o + autoplay com fallback
  window.addEventListener('load', ()=>{
    AudioFX.init();
    AudioFX.setVolume(SOUND_ON ? VOLUME : 0);
    syncVolumeUI();
    setSound(SOUND_ON);
    wireClickSfx();

    // tentar autoplay ao carregar; se bloquear, tocar no primeiro clique
    try{
      AudioFX.playMusic();
    }catch(_){}
    document.addEventListener('click', ()=>{ if(!AudioFX.music) AudioFX.playMusic(); }, {once:true});
  });

  // sempre reanexar sfx se algo mudar no DOM (seguranÃ§a)
  const mo=new MutationObserver(()=>wireClickSfx());
  mo.observe(document.body,{childList:true,subtree:true});
  </script>
</body>
</html>


  
    

       
   
    

