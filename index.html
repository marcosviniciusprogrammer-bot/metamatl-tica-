<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Metamatl√©tica ‚Äî Jogo da Mem√≥ria v3.20 (Hard)</title>
<style>
  :root{
    --bg:#060917; --bg2:#0a1030; --panel:#0c1331; --card:#0e163c;
    --muted:#a7b0c7; --text:#f2f6ff; --accent:#7aa2ff;
    --radius:24px; --shadow:0 18px 50px rgba(0,0,0,.55)
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{
    margin:0; font-family:Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    background:
      radial-gradient(1000px 700px at 5% -10%, #20307a55, transparent),
      radial-gradient(900px 700px at 110% -10%, #0f1f6a66, transparent),
      linear-gradient(180deg, var(--bg), var(--bg2));
    color:var(--text); display:flex; align-items:center; justify-content:center; padding:22px
  }
  .app{ width:min(1150px,100%)}
  .glass{ background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.04));
    border:1px solid rgba(255,255,255,.15); backdrop-filter: blur(12px);
    border-radius:var(--radius); box-shadow:var(--shadow) }
  .wrap{ padding:20px }
  header{ display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:14px; margin-bottom:14px }
  h1{ margin:0; font-size:clamp(24px,5vw,44px); letter-spacing:.4px; text-shadow:0 0 10px rgba(122,162,255,.6)}
  .tag{ background:rgba(122,162,255,.15); border:1px solid rgba(122,162,255,.4); padding:6px 12px; border-radius:14px; font-weight:700; letter-spacing:.4px; color:#d9e4ff }
  .muted{ color:var(--muted) }
  .row{ display:flex; gap:14px; flex-wrap:wrap; align-items:center }
  .btn{ background:rgba(20,28,80,.85); border:1px solid #2a3a7a; color:var(--text);
    padding:14px 16px; border-radius:16px; font-weight:800; letter-spacing:.3px; cursor:pointer;
    transition:.18s transform ease,.18s box-shadow ease }
  .btn:hover{ transform:translateY(-2px); box-shadow:0 12px 28px rgba(90,130,255,.35) }
  .btn:active{ transform:translateY(0) scale(.97) }
  .btn.primary{ background:linear-gradient(180deg, #9ec2ff, #5b86ff); color:#0a0f1e; border:none }
  .screen{ display:none } .screen.active{ display:block }

  /* Lobby */
  .hero{ display:grid; grid-template-columns:1fr; gap:18px }
  .card{ padding:22px; border-radius:22px; background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.04)); border:1px solid rgba(255,255,255,.15) }
  .vol{display:flex;align-items:center;gap:10px}
  .slider{appearance:none;width:200px;height:8px;background:#2a3a7a;border-radius:999px;outline:none}
  .slider::-webkit-slider-thumb{appearance:none;width:18px;height:18px;background:#7aa2ff;border-radius:50%;box-shadow:0 0 6px #7aa2ff;cursor:pointer}
  @media (max-width:740px){ .slider{width:100%} }

  /* Game */
  .board{ display:grid; gap:12px; padding:16px; border-radius:var(--radius);
    border:1px solid rgba(255,255,255,.12); background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03)); box-shadow:var(--shadow) }
  .cols-6{ grid-template-columns:repeat(6, 1fr)}
  .gbar{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between; margin-bottom:12px }
  .hud{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .stat{ background:rgba(12,20,56,.65); border:1px solid #243056; padding:10px 12px; border-radius:12px; font-size:14px }
  .tile{ position:relative; aspect-ratio:3/4; border:none; border-radius:20px; overflow:hidden; cursor:pointer;
    perspective:1000px; outline:none; box-shadow:0 10px 22px rgba(0,0,0,.4) }
  .tile-inner{ position:absolute; inset:0; transform-style:preserve-3d; transition:transform .5s cubic-bezier(.2,.8,.2,1) }
  .tile.flip .tile-inner{ transform:rotateY(180deg) }
  .face{ position:absolute; inset:0; display:flex; align-items:center; justify-content:center; backface-visibility:hidden; border-radius:20px }
  .face.front{ background:radial-gradient(120% 120% at 20% 0%, #1d2a63, #101944 70%); border:1px solid #2f3e89 }
  .face.back{ transform:rotateY(180deg); border:1px solid rgba(255,255,255,.25); background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04)); font-size:clamp(28px,6.5vw,52px) }
  .hint{ margin:8px 0 12px; color:#d6deff; font-weight:800; letter-spacing:.2px; text-shadow:0 0 6px rgba(122,162,255,.5) }

  /* Random events visual states */
  .blackout .face.back{ filter:grayscale(1) brightness(.2); }
  .rot180{ transform:rotate(180deg); transition:transform .5s ease }

  /* Win & event banner */
  .overlay{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; backdrop-filter: blur(10px); background: rgba(6,10,24,.6) }
  .overlay.show{ display:flex }
  .win-card{ background:#0f162b; border:1px solid #2a355a; padding:28px; border-radius:20px; text-align:center; max-width:640px; box-shadow:var(--shadow) }
  .win-title{ display:flex; align-items:center; justify-content:center; gap:10px; font-size:clamp(26px,4.5vw,36px); font-weight:800 }
  .event-banner{ position:fixed; top:14px; left:50%; transform:translateX(-50%); background:#0f162b; border:1px solid #2a355a; color:#fff; padding:12px 18px; border-radius:16px; box-shadow:var(--shadow); font-weight:900; letter-spacing:.3px; display:none }
  .event-banner.show{ display:block; animation:pulse .7s ease 0s 3 }
  @keyframes pulse{0%{transform:translateX(-50%) scale(1)}50%{transform:translateX(-50%) scale(1.06)}100%{transform:translateX(-50%) scale(1)}}
</style>
</head>
<body>
<div class="app">
  <header class="wrap">
    <div>
      <h1>Metamatl√©tica ‚Äî <span class="muted">Jogo da Mem√≥ria</span></h1>
      <div class="muted">Pensamento Computacional e Design de Jogos</div>
    </div>
    <div class="tag">v3.20</div>
  </header>

  <!-- LOBBY -->
  <section id="screen-lobby" class="screen active">
    <div class="wrap glass">
      <div class="hero">
        <div class="card">
          <h2>üéÆ Metamatl√©tica</h2>
          <p>Modo competitivo: 36 cartas (6√ó6), frutas + emojis. Fa√ßa o menor tempo! ‚è±Ô∏è</p>
        </div>
        <div class="card">
          <div class="row">
            <button id="btnPlay" class="btn primary">üöÄ Jogar</button>
            <button id="btnToggleSound" class="btn">üîà Som: ON</button>
            <div class="vol"><span>üîä</span><input id="volumeSlider" class="slider" type="range" min="0" max="100" value="70"></div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- GAME -->
  <section id="screen-game" class="screen">
    <div class="wrap glass" id="gameWrap">
      <div class="gbar">
        <div class="hud">
          <button class="btn" id="btnBackInGame">‚Üê Lobby</button>
          <div class="stat">‚è±Ô∏è <b id="time">00:00</b></div>
        </div>
        <div class="hud">
          <div class="stat">üÉè <b id="moves">0</b> jogadas</div>
          <div class="stat">‚úÖ <b id="pairs">0</b> pares</div>
          <button class="btn" id="btnRestart">Reiniciar</button>
          <button class="btn" id="btnToggleSoundGame">üîà Som: ON</button>
          <div class="vol"><span>üîä</span><input id="volumeSliderGame" class="slider" type="range" min="0" max="100" value="70"></div>
        </div>
      </div>
      <div class="hint" id="hint">Memorize! Pr√©via de 4s üëÄ</div>
      <div id="board" class="board cols-6"></div>
    </div>
  </section>

  <!-- WIN -->
  <div class="overlay" id="overlayWin" aria-hidden="true">
    <div class="win-card">
      <h2 class="win-title"><span>üëë</span> Voc√™ venceu! <span>üëë</span></h2>
      <div class="row" style="justify-content:center; gap:10px; margin:10px 0 6px">
        <div class="stat">‚è±Ô∏è <b id="wTime">00:00</b></div>
        <div class="stat">‚úÖ <b id="wPairs">0</b> pares</div>
        <div class="stat">üéØ <b id="wMoves">0</b> jogadas</div>
      </div>
      <p class="muted" style="margin-top:6px">Desafio conclu√≠do! Tente bater o pr√≥prio tempo üòâ</p>
      <div style="margin-top:10px">
        <button class="btn primary" id="btnPlayAgain">Jogar de novo</button>
        <button class="btn" id="btnBackFromWin">‚Üê Voltar ao Lobby</button>
      </div>
    </div>
  </div>

  <!-- Event banner -->
  <div id="eventBanner" class="event-banner">‚ùó Evento: ...</div>
</div>

<script>
/* ===== helpers ===== */
const $=s=>document.querySelector(s);
const fmt=s=>`${String(Math.floor(s/60)).padStart(2,'0')}:${String(s%60).padStart(2,'0')}`;
const shuffle=a=>{for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]}return a};

/* ===== audio: m√∫sica procedural + sfx, autoplay-friendly ===== */
const AudioFX={
  ctx:null, master:null, inited:false,
  musicBus:null, sfxBus:null, vol:0.7, soundOn:true,
  padIv:null, arpIv:null,
  init(){ if(this.inited) return;
    const AC=window.AudioContext||window.webkitAudioContext; this.ctx=new AC();
    this.master=this.ctx.createGain(); this.master.gain.value=this.vol;
    this.musicBus=this.ctx.createGain(); this.musicBus.gain.value=.55;
    this.sfxBus=this.ctx.createGain(); this.sfxBus.gain.value=1.0;
    this.musicBus.connect(this.master); this.sfxBus.connect(this.master); this.master.connect(this.ctx.destination);
    this.inited=true;
  },
  setVolume(v){ this.vol=v; if(this.master) this.master.gain.value=this.soundOn?v:0; syncSoundUI(); },
  toggle(){ this.soundOn=!this.soundOn; if(this.master) this.master.gain.value=this.soundOn?this.vol:0; syncSoundUI(); },
  tone(f=800,d=.08,t='sine',g=.12){ if(!this.inited) return; const o=this.ctx.createOscillator(), gg=this.ctx.createGain();
    o.type=t; o.frequency.value=f; gg.gain.value=g; o.connect(gg); gg.connect(this.sfxBus);
    const now=this.ctx.currentTime; o.start(now); gg.gain.exponentialRampToValueAtTime(0.0001, now+d); o.stop(now+d); },
  click(){ this.tone(760,.06,'triangle',.16) }, flipOpen(){ this.tone(720,.07,'sine',.14) },
  flipClose(){ this.tone(340,.09,'sine',.14) }, match(){ this.tone(880,.09,'triangle',.16); setTimeout(()=>this.tone(1320,.1,'triangle',.16),70) },
  victory(){ [523,659,784,988,1046].forEach((f,i)=>setTimeout(()=>this.tone(f,.16,'sawtooth',.18),i*140)) },
  startMusic(){
    if(!this.inited) return;
    // pad em acordes
    const chords=[[196,247,294],[220,277,330],[174,220,294],[196,247,330]]; let ci=0;
    const playPad=()=>{
      const now=this.ctx.currentTime, c=chords[ci%chords.length];
      c.forEach((f,i)=>{const o=this.ctx.createOscillator(), g=this.ctx.createGain(); o.type='sine'; o.frequency.value=f;
        g.gain.value=0.0001; o.connect(g); g.connect(this.musicBus); o.start(now);
        g.gain.exponentialRampToValueAtTime(.22/(i+1), now+.22+i*0.05); g.gain.exponentialRampToValueAtTime(0.0001, now+5.6); o.stop(now+5.8);
      }); ci++; };
    playPad(); this.padIv=setInterval(playPad, 5600);
    // arpejo
    const scale=[0,2,4,7,9]; let st=0;
    this.arpIv=setInterval(()=>{ const base=[196,220,174,196][(ci-1+4)%4];
      const f=base*Math.pow(2,(scale[st%scale.length]+12)/12);
      const o=this.ctx.createOscillator(), g=this.ctx.createGain(); o.type='triangle'; o.frequency.value=f; g.gain.value=0.0001;
      o.connect(g); g.connect(this.musicBus); const t=this.ctx.currentTime; o.start(t);
      g.gain.linearRampToValueAtTime(.08,t+.02); g.gain.exponentialRampToValueAtTime(0.0001,t+.35); o.stop(t+.36); st++;
    },420);
  },
  stopMusic(){ if(this.padIv){clearInterval(this.padIv); this.padIv=null} if(this.arpIv){clearInterval(this.arpIv); this.arpIv=null} }
};
function syncSoundUI(){
  const v=Math.round(AudioFX.vol*100);
  $('#btnToggleSound').textContent = AudioFX.soundOn?'üîà Som: ON':'üîá Som: OFF';
  $('#btnToggleSoundGame').textContent = AudioFX.soundOn?'üîà Som: ON':'üîá Som: OFF';
  if($('#volumeSlider')) $('#volumeSlider').value=v;
  if($('#volumeSliderGame')) $('#volumeSliderGame').value=v;
}

/* ===== deck (36 cartas; frutas + emojis misturados) ===== */
const EMOJIS = [
  'üçé','üçå','üçá','üçì','üçç','üçë','üçâ','ü•ù','üçê','üçí','üçä','üçã','ü••','ü•≠','üçÖ','üçà',
  '‚≠ê','üåô','‚öΩ','üèÄ','üé≤','üéß','üéØ','üéµ','üöÄ','üß©','üíé','üî•','‚ùÑÔ∏è','üåà','ü™ô','üéÅ','üîî','üîë','üç™','‚òï'
]; // 38 itens (usaremos os 18 primeiros pares)
function makeDeck(){
  const pairs = 18; // 36 cartas
  const base = EMOJIS.slice(0, pairs).map(e=>({t:'emoji', v:e}));
  return shuffle([...base, ...base]).map((x,i)=>({id:i,key:x.v,t:x.t,matched:false}));
}

/* ===== state & UI ===== */
const screens={lobby:$('#screen-lobby'), game:$('#screen-game')};
function go(to){ Object.values(screens).forEach(s=>s.classList.remove('active')); screens[to].classList.add('active') }
let G=null, timer=null, eventIv=null, previewTo=null;

function buildBoard(){
  const b=$('#board'); b.innerHTML='';
  G.deck.forEach((c,i)=>{
    const el=document.createElement('button'); el.className='tile'; el.dataset.i=i;
    const inner=document.createElement('div'); inner.className='tile-inner';
    const front=document.createElement('div'); front.className='face front';
    const back=document.createElement('div'); back.className='face back'; back.textContent=c.key;
    inner.appendChild(front); inner.appendChild(back); el.appendChild(inner);
    el.addEventListener('click',()=>flip(i));
    b.appendChild(el);
  });
}
function startTimer(){ if(timer) clearInterval(timer); timer=setInterval(()=>{ G.sec++; $('#time').textContent=fmt(G.sec); },1000) }
function stopTimer(){ if(timer){ clearInterval(timer); timer=null } }
function setHint(t){ $('#hint').textContent=t; }

/* ===== random events engine (a cada 120s) ===== */
function showEvent(msg){ const b=$("#eventBanner"); b.textContent='‚ùó '+msg; b.classList.add('show'); setTimeout(()=>b.classList.remove('show'), 2000); }
function eventBlackout(){
  showEvent('Blackout: cartas apagadas por 5s');
  $('#board').classList.add('blackout');
  setTimeout(()=>$('#board').classList.remove('blackout'), 5000);
}
function eventRotate(){
  showEvent('Tela invertida por 6s');
  $('#gameWrap').classList.add('rot180');
  setTimeout(()=>$('#gameWrap').classList.remove('rot180'), 6000);
}
function eventShuffle(){
  showEvent('Embaralhamento!');
  // reordena apenas as N√ÉO combinadas
  const open = G.deck.map((c,idx)=>({c,idx})).filter(x=>!x.c.matched);
  const vals = open.map(x=>x.c.key); shuffle(vals);
  let k=0;
  G.deck.forEach(d=>{ if(!d.matched){ d.key=vals[k++]; } });
  buildBoard();
  // manter viradas das j√° feitas
  const tiles=$('#board').children;
  G.deck.forEach((c,i)=>{ if(c.matched) tiles[i].classList.add('flip'); });
}
function eventPartialReveal(){
  if(G.pairs<2){ eventBlackout(); return; } // s√≥ ap√≥s alguns pares
  showEvent('Revela√ß√£o parcial (5s)');
  const tiles=[...$('#board').children];
  const idxs = tiles.map((_,i)=>i).filter(i=>!G.deck[i].matched);
  shuffle(idxs);
  const take = Math.max(3, Math.floor(idxs.length*0.3));
  const chosen = idxs.slice(0,take);
  chosen.forEach(i=>tiles[i].classList.add('flip'));
  setTimeout(()=>chosen.forEach(i=>{ if(!G.deck[i].matched) tiles[i].classList.remove('flip'); }), 5000);
}
function startEventsClock(){
  if(eventIv) clearInterval(eventIv);
  eventIv=setInterval(()=>{
    const r = Math.random();
    if(r<0.25) eventBlackout();
    else if(r<0.5) eventShuffle();
    else if(r<0.75) eventRotate();
    else eventPartialReveal();
  }, 120000); // 2 minutos
}
function stopEventsClock(){ if(eventIv){ clearInterval(eventIv); eventIv=null } }

/* ===== gameplay ===== */
function newGame(){
  G={ deck:makeDeck(), first:null, second:null, lock:false, moves:0, pairs:0, sec:0 };
  $('#moves').textContent='0'; $('#pairs').textContent='0'; $('#time').textContent='00:00';
  buildBoard(); go('game'); startTimer(); startEventsClock();
  // pr√©via de 4s
  setHint('Memorize! Pr√©via de 4s üëÄ');
  const tiles=[...$('#board').children]; tiles.forEach(t=>t.classList.add('flip'));
  previewTo=setTimeout(()=>{ tiles.forEach(t=>t.classList.remove('flip')); setHint('Escolha uma carta üëÄ'); }, 4000);
}
function flip(i){
  if(G.lock || G.deck[i].matched || G.first===i) return;
  const tiles=$('#board').children;
  if(G.first==null){
    tiles[i].classList.add('flip'); AudioFX.flipOpen(); G.first=i; setHint('Escolha outra carta üëÄ'); return;
  }
  tiles[i].classList.add('flip'); AudioFX.flipOpen(); G.second=i; G.lock=true; G.moves++; $('#moves').textContent=G.moves;
  const a=G.deck[G.first], b=G.deck[G.second];
  if(a.key===b.key){
    a.matched=b.matched=true; G.pairs++; $('#pairs').textContent=G.pairs; AudioFX.match();
    setTimeout(()=>{
      setHint('Voc√™ acertou, parab√©ns! üéâ');
      G.first=null; G.second=null; G.lock=false;
      if(G.pairs===18) win(); else setTimeout(()=>setHint('Escolha uma carta üëÄ'), 500);
    }, 320);
  }else{
    setTimeout(()=>{
      tiles[G.first].classList.remove('flip'); tiles[G.second].classList.remove('flip'); AudioFX.flipClose();
      setHint('Voc√™ errou, tente novamente! üôÑ');
      G.first=null; G.second=null; G.lock=false;
      setTimeout(()=>setHint('Escolha uma carta üëÄ'), 700);
    }, 700);
  }
}
function win(){
  stopTimer(); stopEventsClock(); clearTimeout(previewTo); AudioFX.victory();
  $('#wTime').textContent=fmt(G.sec); $('#wMoves').textContent=G.moves; $('#wPairs').textContent=G.pairs;
  const ov=$('#overlayWin'); ov.classList.add('show'); ov.setAttribute('aria-hidden','false');
}

/* ===== bindings / ui ===== */
function bindButtonSfx(){
  document.querySelectorAll('button').forEach(b=>{
    if(b.__b) return; b.addEventListener('click',()=>AudioFX.click(),{capture:true}); b.__b=true;
  });
}
$('#btnPlay').onclick = ()=> newGame();
$('#btnRestart').onclick = ()=>{ stopEventsClock(); clearTimeout(previewTo); newGame(); };
$('#btnBackInGame').onclick = ()=>{ stopEventsClock(); stopTimer(); go('lobby'); };
$('#btnBackFromWin').onclick = ()=>{ $('#overlayWin').classList.remove('show'); go('lobby'); };
$('#btnPlayAgain').onclick = ()=>{ $('#overlayWin').classList.remove('show'); newGame(); };

$('#btnToggleSound').onclick = ()=> AudioFX.toggle();
$('#btnToggleSoundGame').onclick = ()=> AudioFX.toggle();
$('#volumeSlider').oninput = e => AudioFX.setVolume(e.target.value/100);
$('#volumeSliderGame').oninput = e => AudioFX.setVolume(e.target.value/100);

/* ===== init: autoplay + fallback ===== */
window.addEventListener('load', ()=>{
  AudioFX.init(); AudioFX.startMusic(); bindButtonSfx(); syncSoundUI();
  if(AudioFX.ctx.state==='suspended'){
    const resume=()=>{AudioFX.ctx.resume(); AudioFX.startMusic(); document.removeEventListener('click',resume); };
    document.addEventListener('click', resume, {once:true});
  }
});
</script>
</body>
</html>



   
    

